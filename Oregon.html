<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Population Growth of Oregon Counties 1850 - 2015 </title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>
  <link rel="stylesheet" href="css/style.css">

  <style>
    
  </style>

</head>

<style>
 /* .dimple-custom-tooltip-box {
     fill: red !important;
  }*/
</style>

<body>
  <h1>Oregon Population Growth per County 1850-2015*</h1>
  <p> * 2015 is estimated. </p>
  <p>Starting with early pioneers travelling the Oregon Trail, and continuing today, the population of Oregon,
    continues to increase. With a little knowledge of Oregons geography, and in which counties its largest cities are in
    we can determine that over time, the counties with larger cities are seeing the largest number of people moving
    into them.  While the lower population rural counties are seeing little to no population growth, in some cases 
    they are seeing shrinking populations.</p>

<div id="chartContainer">
 
  <script type="text/javascript">
      // svg size  
      var width = "960";
      var height = "500";
      var margin = "50";
      var button_x = width/8;
      var button_y = height/4;

      var svg = dimple.newSvg("#chartContainer", width, height);

      d3.tsv("Oregon_data.tsv", function (data) {

          // filter data based on census year
          data = dimple.filterData(data, "year", [
              "1850", "1860", "1870", "1880", "1890", "1900",
              "1910", "1920", "1930", "1940", "1950", "1960",
              "1970", "1980", "1990", "2000", "2010", "2015",
          ]);

          // animation time for storyboard
          var duration = 3000;
          // triggers storyboard animation
          var firstTick = true;

          // Create button chart to choose years
          var buttons = new dimple.chart(svg, data);
          buttons.setBounds(width - button_x - margin/2 +20, margin, button_x, height - margin*3 -10);
          var defaultColor = buttons.defaultColors[0];
          var indicatorColor = buttons.defaultColors[2];


          var y = buttons.addCategoryAxis("y", "year");
          y.addOrderRule("year", "Desc");
          //var x = buttons.addMeasureAxis("x", "percent_change")
          var x = buttons.addMeasureAxis("x", "Population");
          x.hidden = true;

          var s = buttons.addSeries(null, dimple.plot.bar);
          s.addEventHandler("click", onClick);

          buttons.draw();

          // Remove the title from the y axis, must happen after chart is drawn
          y.titleShape.remove();

          // cleanup y axis formatting for button chart
          y.shapes.selectAll("line,path").remove();

          y.shapes.selectAll("text")
                  .style("text-anchor", "center")
                  .style("font-size", "12px");

          // Add legend title
          svg.selectAll("title_text")
                  .data(["Click year bar to pause",
                      "animation, click again",
                      "to resume"])
                  .enter()
                  .append("text")
                  .attr("x", width - button_x - margin + 10)
                  .attr("y", function (d, i) { return 10 + i * 12; })
                  .style("font-family", "sans-serif")
                  .style("font-size", "12px")
                  .style("color", "Black")
                  .text(function (d) { return d; });

          // Draw the main bar plot
          var myChart = new dimple.chart(svg, data);
            myChart.setBounds(margin, margin , width - button_x - 2 * margin, height - 3 * margin)
            var x = myChart.addCategoryAxis("x", "County");
            var y = myChart.addMeasureAxis("y", "Population");
            //var y = myChart.addMeasureAxis("y", "percent_change");
            myChart.addSeries(['County'], dimple.plot.bar);
            x.fontSize = "auto";
            y.fontSize = "auto";

          // Add the storyboard
          var story = myChart.setStoryboard("year", onTick);
          story.frameDuration = duration;

          myChart.draw();

          story.storyLabel.remove();
          
          function onClick(e) {
              // Pause the animation
              story.pauseAnimation();
              // If it is already selected resume the animation
              // otherwise pause and move to the selected month
              if (e.yValue === story.getFrameValue()) {
                  story.startAnimation();
              } else {
                  story.goToFrame(e.yValue);
                  story.pauseAnimation();
              }
          }

          // On tick of the main charts storyboard
          function onTick(e) {
              if (!firstTick) {
                  // Color all shapes the same
                  s.shapes
                          .transition()
                          .style("fill", function (d) { return (d.y === e ? indicatorColor.fill : defaultColor.fill) })
                          .style("stroke", function (d) { return (d.y === e ? indicatorColor.stroke : defaultColor.stroke) });
              }
              firstTick = false;
          }
      });
  </script>
</div>
 <div id="references" class="story-text">
    <h2>References</h2>
    <ol>
      <li>https://www.pdx.edu/sites/www.pdx.edu.prc/files/media_assets/2010_PL94_counties_updated.pdf</li>
      <li>http://www.census.gov/population/www/censusdata/PopulationofStatesandCountiesoftheUnitedStates1790-1990.pdf</li>
      <li>http://dimplejs.org/advanced_examples_viewer.html?id=advanced_storyboard_control</li>
      <li>https://github.com/PMSI-AlignAlytics/dimple/wiki/dimple.storyboard</li>
    </ol>

</body>

</html>